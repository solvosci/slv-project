<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="view_task_form2" model="ir.ui.view">
        <field name="name">
            project.task.form (in project_task_calendar_advanced)
        </field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_deadline']" position="before">
                <field name="date_planned_start" readonly="1"/>
                <field
                    name="date_planned_duration"
                    readonly="1"
                    attrs="{
                        'invisible': [('date_planned_start','=',False)],
                    }"
                    widget="float_time"
                />
            </xpath>
            <xpath expr="//field[@name='sequence']" position="after">
                <field name="partner_type" groups="base.group_no_one"/>
            </xpath>
        </field>
    </record>
    <record id="view_task_form2_manager" model="ir.ui.view">
        <field name="name">
            project.task.form manager (in project_task_calendar_advanced)
        </field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="view_task_form2" />
        <field
            name="groups_id"
            eval="[(4, ref('project.group_project_manager'))]"
        />
        <field name="arch" type="xml">
            <field name="date_planned_start" position="attributes">
                <attribute name="readonly">0</attribute>
            </field>
            <field name="date_planned_duration" position="attributes">
                <attribute name="readonly">0</attribute>
            </field>
        </field>
    </record>

    <record id="view_task_tree2" model="ir.ui.view">
        <field name="name">
            project.task.tree (in project_task_calendar_advanced)
        </field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_tree2" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="after">
                <field
                    name="date_planned_start"
                    optional="hide"
                />
            </xpath>
        </field>
    </record>

    <record id="view_task_calendar_advanced" model="ir.ui.view">
        <field name="name">project.task.calendar.advanced</field>
        <field name="model">project.task</field>
        <field eval="100" name="priority"/>
        <field name="arch" type="xml">
            <calendar
                date_start="date_planned_start"
                date_delay="date_planned_duration"
                string="Advanced Task View"
                mode="week"
                color="partner_type_color_id"
                event_limit="5"
                hide_time="False"
                quick_add="False"
            >
                <field name="user_id" avatar_field="image_128" filters="1"/>
                <field
                    name="allowed_user_ids"
                    widget="many2many_tags_avatar"
                    write_model="project.task.user"
                    write_field="allowed_user_id"
                    avatar_field="image_128"
                />
                <field name="project_id"/>
                <field name="partner_type" filters="1"/>
            </calendar>
        </field>
    </record>

    <record id="action_view_task_advanced" model="ir.actions.act_window">
        <field name="name">Advanced Task View</field>
        <field name="res_model">project.task</field>
        <field name="view_mode">calendar</field>
        <field
            name="view_ids"
            eval="[
                (5, 0, 0),
                (0, 0, {'view_mode': 'calendar', 'view_id': ref('view_task_calendar_advanced')}),
            ]"
        />        
    </record>
    <menuitem id="menu_project_report_task_calendar_advanced"
        name="Advanced Task View"
        action="project_task_calendar_advanced.action_view_task_advanced"
        parent="project.menu_project_report"
        sequence="5"
    />

</odoo>
